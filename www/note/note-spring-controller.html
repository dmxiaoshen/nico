<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>springMVC控制层Controller那点事</title>
	<link rel="shortcut icon" href="../static/img/favicon.ico">
    <link rel="stylesheet" type="text/css" media="all" href="../static/css/style.css" />
	<link rel="stylesheet" type="text/css" media="all" href="../static/css/highlight.css" />
    <link rel="stylesheet" type="text/css" media="all" href="../static/css/prettify.css" />
</head>
<body>
    <div id="primary">
        <header id="header">
    <h1 id="site-title">
        <a href="/" title="dmxiaoshen's Blog" rel="home">
            dmxiaoshen's Blog
        </a>
    </h1>
    <nav id="nav">
        <ul>
            <li>
                <a href="/note/">
                    晴耕
                </a>
            </li>
            <li>
                <a href="/article/">
                    雨读
                </a>
            </li>
        </ul>
    </nav>
</header>
        <section id="content">
<h2 class="post_title">springMVC控制层Controller那点事</h2>
<article>
    <h2 id="controller">@Controller</h2><p>srpingMVC中实现一个controller很简单，只需使用@Controller标记即可：  </p>
<div class="highlight"><pre><code class="java"><span class="annotation">@Controller</span>
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span></span>{

}</code></pre></div><p><!--more--></p>
<h2 id="requesetmapping">@RequesetMapping</h2><p>如何生成相应的url映射呢？使用@RequestMapping注解，可以在类上标注也可以在方法上标注，如果都标注了，访问的URL即为类上的加上方法上的。  </p>
<div class="highlight"><pre><code class="java"><span class="annotation">@Controller</span>
<span class="annotation">@RequestMapping</span>(value=<span class="string">"/login"</span>)
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginController</span></span>{

   <span class="annotation">@RequestMapping</span>(value=<span class="string">"/index"</span>)
   <span class="keyword">public</span> String loginPage(){
     <span class="keyword">return</span> <span class="string">"/login/index"</span>;
   }
}</code></pre></div><p>登录url为: xxx/login/index  </p>
<h2 id="数据绑定问题-如-requestparam，-pathvariable">数据绑定问题(如@RequestParam，@PathVariable)</h2><p>解决了url链接的映射问题，下面数据绑定的问题就来了，光有链接不行，很多时候需要传递数据，springMVC传递数据有多种方式。  </p>
<ol>
<li><strong>@RequestParam绑定单个请求参数值</strong></li>
<li><strong>@PathVariable绑定URI模板变量值</strong></li>
<li><strong>@CookieValue绑定Cookie数据值</strong></li>
<li><strong>@RequestHeader绑定请求头数据</strong></li>
<li><strong>@ModelAttribute绑定参数到命令对象</strong></li>
<li><strong>@SessionAttributes绑定命令对象到session</strong></li>
<li><strong>@RequestBody绑定请求的内容区数据并能进行自动类型转换等</strong></li>
<li><strong>@RequestPart绑定&quot;multipart/data&quot;数据,除了能绑定@RequestParam能做到的请求参数外，还能绑定上传的文件等</strong></li>
</ol>
<p><em>除了上边提到的注解，还可以通过如HttpServletRequest等API得到请求数据，但推荐使用注解方式，因为使用起来更简单</em></p>
<p>以下是列子:  </p>
<div class="highlight"><pre><code class="java"><span class="annotation">@Controller</span>
<span class="annotation">@RequestMapping</span>(value=<span class="string">"/test"</span>)
<span class="annotation">@SessionAttributes</span>(value=<span class="string">"userTemp"</span>)
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>{

    <span class="annotation">@RequestMapping</span>(value=<span class="string">"/search"</span>)
    <span class="keyword">public</span> String requestParam(<span class="annotation">@RequestParam</span>(<span class="string">"username"</span>) String username){
        <span class="keyword">return</span> <span class="string">"/test"</span>;
    }

<span class="comment">//    @RequestMapping(value="/search")</span>
<span class="comment">//    public String requestParam2(@RequestParam(value="username",required=true,defaultValue="dmxiaoshen") String username){</span>
<span class="comment">//        return "/test";</span>
<span class="comment">//    }</span>

    <span class="annotation">@RequestMapping</span>(value=<span class="string">"/search/{username}"</span>)
    <span class="keyword">public</span> String pathVariable(<span class="annotation">@PathVariable</span>(<span class="string">"username"</span>) String username){
        <span class="keyword">return</span> <span class="string">"/test"</span>;
    }

    <span class="annotation">@RequestMapping</span>(value=<span class="string">"/cookietest"</span>)
    <span class="keyword">public</span> String cookieValue(<span class="annotation">@CookieValue</span>(value=<span class="string">"JSESSIONID"</span>, defaultValue=<span class="string">""</span>) String sessionId){
        <span class="keyword">return</span> <span class="string">"/test"</span>;
    }

    <span class="annotation">@RequestMapping</span>(value=<span class="string">"/requetheader"</span>)
    <span class="keyword">public</span> String requestHeaderTest( <span class="annotation">@RequestHeader</span>(<span class="string">"User-Agent"</span>) String userAgent,
            <span class="annotation">@RequestHeader</span>(value=<span class="string">"Accept"</span>) String[] accepts){
        <span class="keyword">return</span> <span class="string">"/test"</span>;
    }

    <span class="annotation">@RequestMapping</span>(value=<span class="string">"/addUserFirst"</span>)
    <span class="keyword">public</span> String addUserFirst(<span class="annotation">@ModelAttribute</span>(<span class="string">"userTemp"</span>) User userTemp){        
        <span class="keyword">return</span> <span class="string">"redirect:/test/addUserSecond"</span>;
    }

    <span class="annotation">@RequestMapping</span>(value=<span class="string">"/addUserSecond"</span>)
    <span class="keyword">public</span> String addUserSecond(<span class="annotation">@ModelAttribute</span>(<span class="string">"userTemp"</span>) User userTemp,SessionStatus sessionStatus){    
        sessionStatus.setComplete();<span class="comment">//创建完成清除session信息</span>
        <span class="keyword">return</span> <span class="string">"redirect:/"</span>;
    }

    <span class="annotation">@ModelAttribute</span>(<span class="string">"userTemp"</span>)
    <span class="keyword">public</span> User tempUser(){
        <span class="keyword">return</span> <span class="keyword">new</span> User();
    }
}</code></pre></div><h2 id="方法返回值">方法返回值</h2><p>Controller层的方法返回值有：  </p>
<p><strong>ModelAndView</strong>  </p>
<div class="highlight"><pre><code class="java"><span class="annotation">@RequestMapping</span>(value=<span class="string">"/index"</span>)
    <span class="keyword">public</span> ModelAndView t(){
        ModelAndView result = <span class="keyword">new</span> ModelAndView(<span class="string">"/test/index"</span>);
        result.addObject(<span class="string">"key"</span>, <span class="string">"value"</span>);
        <span class="keyword">return</span> result;
    }</code></pre></div><p><strong>String</strong>  </p>
<div class="highlight"><pre><code class="java"><span class="annotation">@RequestMapping</span>(value=<span class="string">"/index"</span>)
    <span class="keyword">public</span> String t(){
        <span class="keyword">return</span> <span class="string">"/test/index"</span>;
    }</code></pre></div><p><strong>void</strong>  </p>
<p>这里要注意，如果是get方法，那么返回的视图名称即为对应的访问地址  </p>
<div class="highlight"><pre><code class="java"><span class="annotation">@RequestMapping</span>(value=<span class="string">"/index"</span>)
    <span class="keyword">public</span> <span class="keyword">void</span> t(){

    }</code></pre></div><p>换句话说，如果视图名称与访问地址相同的话，即可不用返回，默认即可。  </p>
<p><strong>Object</strong>  </p>
<p>一般用于ajax查询数据，常使用标签@ResponseBody与之配合，一般都转成json数据输出给前台。  </p>
<h2 id="数据传递">数据传递</h2><p>后台如何传递数据到前台呢？  </p>
<p><strong>Model、Map、ModelMap</strong>  </p>
<div class="highlight"><pre><code class="java"><span class="comment">//Spring Web MVC 提供Model、Map或ModelMap让我们能去暴露渲染视图需要的模型数据。</span>
<span class="keyword">public</span> String createUser(Model model, Map model2, ModelMap model3) {
    model.addAttribute(<span class="string">"a"</span>, <span class="string">"a"</span>);
    model2.put(<span class="string">"b"</span>, <span class="string">"b"</span>);
    model3.put(<span class="string">"c"</span>, <span class="string">"c"</span>);
    System. out.println(model == model2);
    System. out.println(model2 == model3);
    <span class="keyword">return</span> <span class="string">"success"</span>;
}</code></pre></div><p>补充：ModelAndView的addObject方法也有类似的功能。</p>
<p>参考网址: <a href="http://blog.sina.com.cn/s/blog_a85398ce0101feek.html">http://blog.sina.com.cn/s/blog_a85398ce0101feek.html</a></p>

</article>
<div class="meta">
    <ul class="tags">
            <li><a href="/tag/springMVC">springMVC</a></li>
    </ul>
</div>
<div class="date">2014-12-10</div>
<div class="ds-thread"></div>
<script type="text/javascript">
	var duoshuoQuery = {short_name:"dmxiaoshen"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>
            <!-- Duoshuo Comment END -->

        </section>
    </div>
    <footer>
    © 2015-2016 dmxiaoshen's Blog | Powered by <a href="http://lab.lepture.com/nico/" target="_blank">Nico</a>
</footer>
<script defer async type="text/javascript" src="//hm.baidu.com/h.js?f10c9b0005de625e589f7dc9804b2787"></script>

    <script defer async type="text/javascript" src="../static/js/run_prettify.js"></script>
	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?84405cc8993d00d19f760d6fa7ec02ca";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>

</body>
</html>