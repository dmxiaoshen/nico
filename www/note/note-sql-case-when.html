<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>SQL中的case when语句</title>
	<link rel="shortcut icon" href="../static/img/favicon.ico">
    <link rel="stylesheet" type="text/css" media="all" href="../static/css/style.css" />
	<link rel="stylesheet" type="text/css" media="all" href="../static/css/highlight.css" />
    <link rel="stylesheet" type="text/css" media="all" href="../static/css/prettify.css" />
</head>
<body>
    <div id="primary">
        <header id="header">
    <h1 id="site-title">
        <a href="/" title="dmxiaoshen's Blog" rel="home">
            dmxiaoshen's Blog
        </a>
    </h1>
    <nav id="nav">
        <ul>
            <li>
                <a href="/note/">
                    晴耕
                </a>
            </li>
            <li>
                <a href="/article/">
                    雨读
                </a>
            </li>
        </ul>
    </nav>
</header>
        <section id="content">
<h2 class="post_title">SQL中的case when语句</h2>
<article>
    <h2 id="case-when语法">case when语法</h2><p>case when语句有两种语法，<strong>简单case函数</strong>和<strong>case搜索函数</strong>。</p>
<p>简单case函数；</p>
<div class="highlight"><pre><code class="sql"><span class="operator"><span class="keyword">select</span> <span class="keyword">case</span> sex <span class="keyword">when</span> <span class="string">'1'</span> <span class="keyword">then</span> <span class="string">'男'</span> 
<span class="keyword">when</span> <span class="string">'2'</span> <span class="keyword">then</span> <span class="string">'女'</span> 
<span class="keyword">else</span> <span class="string">'其他'</span> <span class="keyword">end</span> <span class="keyword">as</span> <span class="string">'性别'</span> 
<span class="keyword">from</span> employee;</span></code></pre></div><p>case搜索函数:</p>
<div class="highlight"><pre><code class="sql"><span class="operator"><span class="keyword">select</span> <span class="keyword">case</span> <span class="keyword">when</span> salary&lt;<span class="number">600</span> <span class="keyword">then</span> <span class="string">'A'</span> 
<span class="keyword">when</span> salary&gt;=<span class="number">600</span> <span class="keyword">and</span> salary&lt;<span class="number">1000</span> <span class="keyword">then</span> <span class="string">'B'</span> 
<span class="keyword">else</span> <span class="string">'C'</span> <span class="keyword">end</span> <span class="keyword">as</span> <span class="string">'工资级别'</span> 
<span class="keyword">from</span> employee;</span></code></pre></div><p><strong>两者区别是:</strong>简单case函数when后面是值，case搜索函数when后面是条件表达式，明显后者更为灵活，<br>就拿例子来说，工资(salary)按范围分等级而不是具体的值。</p>
<h2 id="与sum函数结合使用">与sum函数结合使用</h2><p><strong>问题:如何统计employee表男员工和女员工的数量?</strong>  </p>
<div class="highlight"><pre><code class="sql"><span class="operator"><span class="keyword">select</span> <span class="aggregate">sum</span>(<span class="keyword">case</span> sex <span class="keyword">when</span> <span class="string">'1'</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">'男员工数量'</span> ,
<span class="aggregate">sum</span>(<span class="keyword">case</span> sex <span class="keyword">when</span> <span class="string">'2'</span> <span class="keyword">then</span> <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">'女员工数量'</span> 
<span class="keyword">from</span> employee;</span></code></pre></div><h2 id="典型的行列转换">典型的行列转换</h2><p>典型的成绩表</p>
<table>
<thead>
<tr>
<th>学生号</th>
<th>科目</th>
<th>成绩</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>语文</td>
<td>79</td>
</tr>
<tr>
<td>1</td>
<td>数学</td>
<td>88</td>
</tr>
<tr>
<td>2</td>
<td>数学</td>
<td>95</td>
</tr>
<tr>
<td>3</td>
<td>语文</td>
<td>92</td>
</tr>
<tr>
<td>2</td>
<td>语文</td>
<td>89</td>
</tr>
<tr>
<td>3</td>
<td>数学</td>
<td>79</td>
</tr>
</tbody>
</table>
<p>要求需要如下展示  </p>
<table>
<thead>
<tr>
<th>学生号</th>
<th>语文</th>
<th>数学</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>79</td>
<td>88</td>
</tr>
<tr>
<td>2</td>
<td>89</td>
<td>95</td>
</tr>
<tr>
<td>3</td>
<td>92</td>
<td>79</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre><code class="sql"><span class="operator"><span class="keyword">select</span> 学生号,<span class="aggregate">sum</span>(<span class="keyword">case</span> 科目 <span class="keyword">when</span> <span class="string">'语文'</span> <span class="keyword">then</span> 成绩 <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">'语文'</span>,
<span class="aggregate">sum</span>(<span class="keyword">case</span> 科目 <span class="keyword">when</span> <span class="string">'数学'</span> <span class="keyword">then</span> 成绩 <span class="keyword">end</span>) <span class="keyword">as</span> <span class="string">'数学'</span> 
<span class="keyword">from</span> 成绩表 
<span class="keyword">group</span> <span class="keyword">by</span> 学生号;</span></code></pre></div><p><strong>ps: case when还可以用在where语句和group by语句后面。</strong></p>

</article>
<div class="meta">
    <ul class="tags">
            <li><a href="/tag/sql语句">sql语句</a></li>
    </ul>
</div>
<div class="date">2015-01-08</div>
<div class="ds-thread"></div>
<script type="text/javascript">
	var duoshuoQuery = {short_name:"dmxiaoshen"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>
            <!-- Duoshuo Comment END -->

        </section>
    </div>
    <footer>
    © 2015-2016 dmxiaoshen's Blog | Powered by <a href="http://lab.lepture.com/nico/" target="_blank">Nico</a>
</footer>
<script defer async type="text/javascript" src="//hm.baidu.com/h.js?f10c9b0005de625e589f7dc9804b2787"></script>

    <script defer async type="text/javascript" src="../static/js/run_prettify.js"></script>
	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?84405cc8993d00d19f760d6fa7ec02ca";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>

</body>
</html>